<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nabila Ahmad - Grand Creative Studio</title>
    
    <!-- Impor Font Premium -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">

    <style>
        /* --- CSS Reset & Global Styling --- */
        :root {
            --bg-deep-space: #111317;
            --surface-primary: #1a1d23;
            --surface-secondary: #252932;
            --border-color: #333842;
            --text-primary: #e0e0e0;
            --text-secondary: #a0a4b8;
            --accent-primary: #8A2BE2; /* Ungu Anggrek */
            --accent-secondary: #4A90E2; /* Biru Langit */
            --font-ui: 'Poppins', sans-serif;
            --font-literary: 'Cormorant Garamond', serif;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            font-family: var(--font-ui);
            background-color: var(--bg-deep-space);
            color: var(--text-primary);
            line-height: 1.7;
            overflow-x: hidden;
        }

        /* --- Layout Utama --- */
        .studio-container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 2rem;
        }
        .studio-header {
            text-align: center;
            margin-bottom: 3rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid var(--border-color);
        }
        .studio-header h1 {
            font-size: 3rem;
            font-weight: 700;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
        }
        .studio-header p {
            color: var(--text-secondary);
            font-size: 1.2rem;
        }
        .card {
            background-color: var(--surface-primary);
            border-radius: 16px;
            padding: 2rem;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }
        .card:hover {
            border-color: var(--accent-secondary);
        }

        /* --- Konfigurasi API --- */
        .api-config-card { margin-bottom: 2rem; }
        .api-config-card h2 { font-size: 1.5rem; margin-bottom: 1rem; color: var(--text-primary); }
        .api-config-card p { color: #ffd700; background: rgba(255, 215, 0, 0.05); padding: 0.5rem 1rem; border-radius: 8px; border-left: 3px solid #ffd700; }
        input[type="password"] {
            width: 100%; padding: 1rem; margin-top: 1rem; font-size: 1rem;
            background-color: var(--surface-secondary); border: 1px solid var(--border-color);
            border-radius: 8px; color: var(--text-primary); font-family: var(--font-ui);
        }

        /* --- Sistem Tab --- */
        .studio-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 2rem;
        }
        .tab-button {
            padding: 1rem 2rem;
            cursor: pointer;
            border: none;
            background: none;
            color: var(--text-secondary);
            font-size: 1.1rem;
            font-weight: 600;
            position: relative;
            transition: color 0.3s ease;
        }
        .tab-button:hover { color: var(--text-primary); }
        .tab-button.active { color: var(--text-primary); }
        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            border-radius: 3px;
        }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.5s ease; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* --- Panel Kontrol --- */
        .control-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
        }
        .control-grid .card h3 { font-size: 1.3rem; margin-bottom: 1.5rem; }
        label { display: block; font-weight: 600; color: var(--text-secondary); margin-bottom: 0.5rem; }
        input[type="text"], textarea, select {
            width: 100%; padding: 0.8rem 1rem; background-color: var(--surface-secondary);
            border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary);
            font-family: var(--font-ui); font-size: 1rem; margin-bottom: 1.5rem;
        }
        textarea { resize: vertical; min-height: 120px; }
        .main-action-button {
            width: 100%; padding: 1.2rem; font-size: 1.2rem; font-weight: 700;
            color: white; background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            border: none; border-radius: 8px; cursor: pointer; margin-top: 1rem;
            transition: all 0.3s ease; display: flex; justify-content: center; align-items: center; gap: 1rem;
        }
        .main-action-button:hover:not(:disabled) { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(0,0,0,0.2); }
        .main-action-button:disabled { opacity: 0.5; cursor: not-allowed; }

        /* --- Area Hasil --- */
        .output-container { margin-top: 3rem; }
        .output-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; }
        .output-header h2 { font-size: 2rem; }
        .copy-button {
            padding: 0.6rem 1.2rem; background: var(--surface-secondary);
            color: var(--text-secondary); border: 1px solid var(--border-color);
            border-radius: 8px; cursor: pointer; transition: all 0.3s ease;
        }
        .copy-button:hover { background-color: var(--accent-secondary); color: white; border-color: var(--accent-secondary); }
        .output-box {
            background: var(--surface-primary); border-radius: 16px;
            padding: 2rem 3rem; border: 1px solid var(--border-color);
            min-height: 300px; font-family: var(--font-literary); /* FONT SASTRA */
            font-size: 1.3rem; line-height: 1.8; white-space: pre-wrap;
            color: var(--text-primary);
        }
        .placeholder-text { color: var(--text-secondary); font-style: italic; font-family: var(--font-ui); font-size: 1.1rem; }

        /* --- Spinner --- */
        .spinner {
            width: 24px; height: 24px; border: 3px solid rgba(255, 255, 255, 0.3);
            border-top-color: #fff; border-radius: 50%; animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div class="studio-container">
        <header class="studio-header">
            <h1>Grand Creative Studio</h1>
            <p>Ditenagai oleh Nabila Ahmad & OpenAI</p>
        </header>

        <section class="card api-config-card">
            <h2>üîë Konfigurasi API</h2>
            <p>API Key Anda hanya digunakan di browser ini dan tidak disimpan di mana pun. Wajib diisi.</p>
            <input type="password" id="apiKey" placeholder="Masukkan OpenAI API Key Anda (sk-...)">
        </section>

        <!-- Navigasi Tab -->
        <nav class="studio-tabs">
            <button class="tab-button active" data-tab="novelStudio">Novel Studio</button>
            <button class="tab-button" data-tab="sastraStudio">Sastra Studio</button>
        </nav>

        <!-- Konten Novel Studio -->
        <div id="novelStudio" class="tab-content active">
            <div class="control-grid">
                <div class="card">
                    <h3>üìñ Pengaturan Novel</h3>
                    <label for="novelGenre">Pilih Genre</label>
                    <select id="novelGenre">
                        <option value="Contemporary Romance">Romansa Kontemporer</option>
                        <option value="Historical Romance">Romansa Sejarah</option>
                        <option value="Fantasy">Fantasi (High/Low)</option>
                        <option value="Urban Fantasy">Fantasi Urban</option>
                        <option value="Science Fiction">Fiksi Ilmiah (Sci-Fi)</option>
                        <option value="Dystopian">Distopia</option>
                        <option value="Mystery">Misteri / Detektif</option>
                        <option value="Thriller">Thriller / Psikologis</option>
                        <option value="Horror">Horor / Supernatural</option>
                        <option value="Adventure">Petualangan</option>
                        <option value="Young Adult (YA)">Remaja (Young Adult)</option>
                        <option value="Historical Fiction">Fiksi Sejarah</option>
                        <option value="Wuxia / Xianxia">Wuxia / Xianxia</option>
                    </select>

                    <label for="novelPremis">Premis / Ide Dasar Cerita</label>
                    <textarea id="novelPremis" rows="6" placeholder="Contoh: Seorang pustakawan menemukan buku kuno yang bisa membawanya ke dunia lain, tapi setiap kali ia kembali, satu kenangan tentang dunianya sendiri akan hilang."></textarea>
                </div>
                <div class="card">
                    <h3>üöÄ Generator Bab</h3>
                    <p style="color:var(--text-secondary); margin-bottom:2rem;">Tekan tombol di bawah untuk membuat bab pertama atau melanjutkan cerita dari teks di area hasil.</p>
                    <button id="generateNovelBtn" class="main-action-button">
                        <span class="btn-text">Buat Bab (4000+ Kata)</span>
                        <div class="spinner" style="display: none;"></div>
                    </button>
                </div>
            </div>

            <div class="output-container">
                <div class="output-header">
                    <h2>Naskah Novel Anda</h2>
                    <button class="copy-button" onclick="copyToClipboard('novelOutput')">Salin Naskah</button>
                </div>
                <div id="novelOutput" class="output-box" contenteditable="true">
                    <p class="placeholder-text">Bab novel Anda akan muncul di sini. Isi pengaturan dan tekan tombol buat bab...</p>
                </div>
            </div>
        </div>

        <!-- Konten Sastra Studio (Puisi/Lirik) -->
        <div id="sastraStudio" class="tab-content">
            <div class="control-grid">
                <div class="card">
                    <h3>‚úíÔ∏è Pengaturan Sastra</h3>
                    <label for="sastraType">Jenis Karya</label>
                    <select id="sastraType">
                        <option value="Puisi">Puisi</option>
                        <option value="Lirik Lagu">Lirik Lagu</option>
                    </select>
                    
                    <label for="sastraTheme">Tema Utama</label>
                    <input type="text" id="sastraTheme" placeholder="Contoh: Kerinduan pada kampung halaman, euforia cinta pertama">
                    
                    <label for="sastraStyle">Gaya / Suasana Hati</label>
                    <input type="text" id="sastraStyle" placeholder="Contoh: Melankolis, penuh semangat, surealis, renungan filosofis">
                    
                    <label for="sastraElements">Elemen Kunci (opsional)</label>
                    <input type="text" id="sastraElements" placeholder="Contoh: Senja, secangkir kopi, jalanan kota yang basah">
                </div>
                <div class="card">
                    <h3>‚ú® Generator Karya</h3>
                    <p style="color:var(--text-secondary); margin-bottom:2rem;">Isi semua pengaturan untuk memandu AI menciptakan sebuah mahakarya sastra dengan cita rasa premium.</p>
                    <button id="generateSastraBtn" class="main-action-button">
                        <span class="btn-text">Buat Mahakarya</span>
                        <div class="spinner" style="display: none;"></div>
                    </button>
                </div>
            </div>

            <div class="output-container">
                 <div class="output-header">
                    <h2>Mahakarya Sastra Anda</h2>
                    <button class="copy-button" onclick="copyToClipboard('sastraOutput')">Salin Karya</button>
                </div>
                <div id="sastraOutput" class="output-box">
                    <p class="placeholder-text">Puisi atau lirik lagu Anda akan muncul di sini...</p>
                </div>
            </div>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // === ELEMEN DOM ===
            const apiKeyInput = document.getElementById('apiKey');
            const tabs = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');

            // Novel Studio Elements
            const novelGenreSelect = document.getElementById('novelGenre');
            const novelPremisTextarea = document.getElementById('novelPremis');
            const generateNovelBtn = document.getElementById('generateNovelBtn');
            const novelOutputDiv = document.getElementById('novelOutput');

            // Sastra Studio Elements
            const sastraTypeSelect = document.getElementById('sastraType');
            const sastraThemeInput = document.getElementById('sastraTheme');
            const sastraStyleInput = document.getElementById('sastraStyle');
            const sastraElementsInput = document.getElementById('sastraElements');
            const generateSastraBtn = document.getElementById('generateSastraBtn');
            const sastraOutputDiv = document.getElementById('sastraOutput');

            // === FUNGSI UTAMA ===

            // Sistem Tab
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(item => item.classList.remove('active'));
                    tab.classList.add('active');

                    const target = document.getElementById(tab.dataset.tab);
                    tabContents.forEach(content => content.classList.remove('active'));
                    target.classList.add('active');
                });
            });

            // Pemanggil API Universal
            async function callOpenAI(messages, max_tokens, buttonElement) {
                const apiKey = apiKeyInput.value.trim();
                if (!apiKey) {
                    alert('Harap masukkan OpenAI API Key Anda terlebih dahulu!');
                    return null;
                }

                setLoading(buttonElement, true);
                
                try {
                    const response = await fetch('https://api.openai.com/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${apiKey}`,
                        },
                        body: JSON.stringify({
                            model: "gpt-4o-mini",
                            messages: messages,
                            max_tokens: max_tokens,
                            temperature: 0.75
                        }),
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error.message || 'Gagal mendapat respon dari AI.');
                    }

                    const data = await response.json();
                    return data.choices[0].message.content;

                } catch (error) {
                    alert(`Terjadi kesalahan: ${error.message}`);
                    return null;
                } finally {
                    setLoading(buttonElement, false);
                }
            }

            // Handler untuk Novel Studio
            generateNovelBtn.addEventListener('click', async () => {
                const genre = novelGenreSelect.value;
                const premis = novelPremisTextarea.value.trim();
                const currentText = novelOutputDiv.textContent.trim();
                const isFirstChapter = currentText.startsWith('Bab novel Anda akan muncul');

                if (!premis) {
                    alert('Harap isi premis atau ide dasar cerita!');
                    return;
                }

                let messages = [];
                if (isFirstChapter) {
                    const systemPrompt = `Anda adalah seorang novelis master kelas dunia bernama 'Nabila-AI'. Tugas Anda adalah menulis bab-bab novel yang sangat panjang, detail, dan kaya secara emosional, sesuai standar platform novel premium. Genre novel ini adalah ${genre}. Premis utamanya adalah: "${premis}". Setiap bab yang Anda tulis harus mendalam, menjelajahi pikiran karakter, membangun dunia dengan deskripsi yang hidup, dan memiliki subplot yang menarik. PENTING: Target panjang untuk setiap bab adalah 4000 kata atau lebih. Jangan pernah menulis kurang dari itu. Mulai dengan Bab 1. Anda HANYA boleh merespon dengan teks cerita, tanpa komentar pembuka atau penutup.`;
                    messages.push({ role: 'system', content: systemPrompt });
                    messages.push({ role: 'user', content: 'Tuliskan Bab 1 dari novel ini dengan panjang minimal 4000 kata.' });
                } else {
                    const systemPrompt = `Anda adalah seorang novelis master kelas dunia bernama 'Nabila-AI' yang sedang melanjutkan sebuah novel. Ingat semua konteks sebelumnya. PENTING: Target panjang untuk bab selanjutnya adalah 4000 kata atau lebih. Jelajahi lebih dalam, jangan terburu-buru. Anda HANYA boleh merespon dengan teks cerita, tanpa komentar.`;
                    messages.push({ role: 'system', content: systemPrompt });
                    messages.push({ role: 'assistant', content: `Ini adalah naskah sejauh ini: ${currentText}` });
                    messages.push({ role: 'user', content: 'Lanjutkan cerita ini dengan menulis bab berikutnya. Pastikan panjangnya minimal 4000 kata.' });
                }

                const result = await callOpenAI(messages, 4095, generateNovelBtn);
                if (result) {
                    if (isFirstChapter) {
                        novelOutputDiv.innerHTML = result; // Ganti placeholder
                    } else {
                        novelOutputDiv.innerHTML += `\n\n\n${result}`; // Tambah bab baru
                    }
                }
            });

            // Handler untuk Sastra Studio
            generateSastraBtn.addEventListener('click', async () => {
                const type = sastraTypeSelect.value;
                const theme = sastraThemeInput.value.trim();
                const style = sastraStyleInput.value.trim();
                const elements = sastraElementsInput.value.trim();

                if (!theme || !style) {
                    alert('Harap isi Tema Utama dan Gaya / Suasana Hati!');
                    return;
                }
                
                const systemPrompt = `Anda adalah seorang maestro sastra, perpaduan antara kebijaksanaan Jalaluddin Rumi dan ketajaman Chairil Anwar. Gaya Anda sangat metaforis, mendalam, dan menghindari klise. Gunakan citraan yang kuat (visual, pendengaran, penciuman), rima internal, dan aliterasi. Jawaban Anda harus berupa karya sastra yang utuh, tanpa komentar atau penjelasan tambahan.`;
                let userPrompt = `Buatkan sebuah ${type} dengan cita rasa sastra premium. Temanya adalah "${theme}" dengan suasana hati yang ${style}.`;
                if(elements){
                    userPrompt += ` Sertakan elemen-elemen berikut dalam karya Anda: ${elements}.`;
                }

                const messages = [
                    { role: 'system', content: systemPrompt },
                    { role: 'user', content: userPrompt }
                ];
                
                const result = await callOpenAI(messages, 1000, generateSastraBtn);
                if(result){
                    sastraOutputDiv.innerHTML = result;
                }
            });

            // === FUNGSI BANTU ===
            function setLoading(button, isLoading) {
                const spinner = button.querySelector('.spinner');
                const btnText = button.querySelector('.btn-text');
                if (isLoading) {
                    button.disabled = true;
                    spinner.style.display = 'block';
                    btnText.style.opacity = '0.5';
                } else {
                    button.disabled = false;
                    spinner.style.display = 'none';
                    btnText.style.opacity = '1';
                }
            }
        });

        // Fungsi Copy to Clipboard (ditaruh di luar agar bisa dipanggil dari HTML)
        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            const textToCopy = element.innerText || element.textContent;
            navigator.clipboard.writeText(textToCopy).then(() => {
                alert('Teks berhasil disalin ke clipboard!');
            }, (err) => {
                alert('Gagal menyalin teks.');
            });
        }
    </script>

</body>
</html>
